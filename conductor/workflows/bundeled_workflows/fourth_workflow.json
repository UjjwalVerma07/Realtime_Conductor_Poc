{
  "name": "US_CA_Name_Email_Workflow",
  "description": "Workflow to run us_address_lookup,ca_address_lookup,nameparse,email_hygiene services respectively on canonical records",
  "version": 1,
  "inputParameters": [
    "canonical_records",
    "jobId",
    "column_map" 
  ],
  "tasks": [
    {
      "name": "us_address_lookup_task",
      "taskReferenceName": "us_address_lookup",
      "type": "HTTP",
      "startDelay": 0,
      "retryCount": 3,
      "retryDelaySeconds": 2,
      "timeoutSeconds": 600,
      "connectionTimeout": 60000,
      "readTimeout": 600000,
      "inputParameters": {
        "http_request": {
          "uri": "http://us-address-lookup-realtime:9000/process",
          "method": "POST",
          "connectionTimeOut": 3000,
          "readTimeOut": 10000,
          "body": {
            "header": {
              "tags": ["API","nua","da","dps","wb","analysis","ODBx","compilation","da-dps-reader-lambda","tech-showcase"],
              "jobId": "${workflow.input.jobId}",
              "systemId": "workbench"
            },
            "request": "${workflow.input.canonical_records}"
          },
          "headers": {
            "Content-Type": "application/json"
          }
        }
      }
    },
    {
      "name": "ca_address_lookup_task",
      "taskReferenceName": "ca_address_lookup",
      "type": "HTTP",
      "startDelay": 0,
      "retryCount": 3,
      "retryDelaySeconds": 2,
      "timeoutSeconds": 600,
      "connectionTimeout": 60000,
      "readTimeout": 600000,
      "inputParameters": {
        "http_request": {
          "uri": "http://ca-address-lookup-realtime:9000/process",
          "method": "POST",
          "connectionTimeOut": 3000,
          "readTimeOut": 10000,
          "body": {
            "header": {
              "tags": ["API","nua","da","dps","wb","analysis","ODBx","compilation","da-dps-reader-lambda","tech-showcase"],
              "jobId": "${workflow.input.jobId}",
              "systemId": "workbench"
            },
            "request": "${us_address_lookup.output.response.body.canonical_records}"
          },
          "headers": {
            "Content-Type": "application/json"
          }
        }
      }
    },
     {
      "name": "nameparse_task",
      "taskReferenceName": "nameparse",
      "type": "HTTP",
      "startDelay": 0,
      "retryCount": 3,
      "retryDelaySeconds": 2,
      "timeoutSeconds": 600,
      "connectionTimeout": 60000,
      "readTimeout": 600000,
      "inputParameters": {
        "http_request": {
          "uri": "http://nameparse-realtime:9000/process",
          "method": "POST",
            "connectionTimeOut": 3000,
      "readTimeOut": 10000, 
          "body": {
            "header": {
              "tags": ["API","nua","da","dps","wb","analysis","ODBx","compilation","da-dps-reader-lambda","tech-showcase"],
              "jobId": "${workflow.input.jobId}",
              "systemId": "workbench"
            },
            "request": "${ca_address_lookup.output.response.body.canonical_records}",
            "config":"${workflow.input.nameparse_config}"
          },
          "headers": {
            "Content-Type": "application/json"
          }
        }
      }
    },
    {
      "name": "email_hygiene_task",
      "taskReferenceName": "email_hygiene",
      "type": "HTTP",
      "startDelay": 0,
      "retryCount": 3,
      "retryDelaySeconds": 2,
      "timeoutSeconds": 600,
      "connectionTimeout": 60000,
      "readTimeout": 600000,
      "inputParameters": {
        "http_request": {
          "uri": "http://email-hygiene-realtime:9000/process",
          "method": "POST",
            "connectionTimeOut": 3000,
      "readTimeOut": 10000, 
          "body": {
            "header": {
              "tags": ["API","nua","da","dps","wb","analysis","compilation","da-dps-reader-lambda","tech-showcase"],
              "jobId": "${workflow.input.jobId}"
            },
            "request": "${nameparse.output.response.body.canonical_records}"
          },
          "headers": {
            "Content-Type": "application/json"
          }
        }
      }
    },
    {
      "name": "combined_suppression_task",
      "taskReferenceName": "combined_suppression",
      "type": "HTTP",
      "startDelay": 0,
      "retryCount": 3,
      "retryDelaySeconds": 2,
      "timeoutSeconds": 600,
      "connectionTimeout": 60000,
      "readTimeout": 600000,
      "inputParameters": {
        "http_request": {
          "uri": "http://combined-suppression-realtime:9000/process",
          "method": "POST",
          "connectionTimeOut": 3000,
          "readTimeOut": 10000,
          "body": {
            "header": {
              "tags": ["API","nua","da","dps","wb","analysis","ODBx","compilation","da-dps-reader-lambda","tech-showcase"],
              "jobId": "${workflow.input.jobId}",
              "systemId": "workbench"
            },
            "request": "${email_hygiene.output.response.body.canonical_records}",
            "combined_suppression_config": "${workflow.input.combined_suppression_config}"
          },
          "headers": {
            "Content-Type": "application/json"
          }
        }
      }
    },
    {
      "name": "export_to_csv_task",
      "taskReferenceName": "export_to_csv",
      "type": "HTTP",
      "startDelay": 0,
      "retryCount": 3,
      "retryDelaySeconds": 2,
      "timeoutSeconds": 600,
      "connectionTimeout": 60000,
      "readTimeout": 600000,
      "inputParameters": {
        "http_request": {
          "uri": "http://export-to-csv:9000/process",
          "method": "POST",
          "connectionTimeOut": 3000,
          "readTimeOut": 10000,
          "body": {
            "canonical_records": "${combined_suppression.output.response.body.canonical_records}",
            "jobId": "${workflow.input.jobId}",
            "output_field_selection": "${workflow.input.output_field_selection}"
          },
          "headers": {
            "Content-Type": "application/json"
          }
        }
      }
    }
  ],
  "outputParameters": {
    "final_canonical_records": "${email_hygiene.output.response.body.canonical_records}"
  },
  "schemaVersion": 2
}
