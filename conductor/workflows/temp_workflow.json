[
{
  "name": "dynamic_email_nameparse_workflow",
  "description": "Workflow to run dynamic services on canonical records",
  "version": 8,
  "inputParameters": [
    "canonical_records",
    "jobId",
    "column_map"
  ],
  "tasks": [
    {
      "name": "nameparse_task",
      "taskReferenceName": "nameparse",
      "type": "HTTP",
      "startDelay": 0,
      "retryCount": 3,
      "retryDelaySeconds": 2,
      "timeoutSeconds": 30,
      "inputParameters": {
        "http_request": {
          "uri": "http://nameparse-realtime:9000/process",
          "method": "POST",
          "connectionTimeOut": 3000,
          "readTimeOut": 10000, 
          "body": {
            "header": {
              "tags": ["API","nua","da","dps","wb","analysis","ODBx","compilation","da-dps-reader-lambda","tech-showcase"],
              "jobId": "${workflow.input.jobId}",
              "systemId": "workbench"
            },
            "request": "${workflow.input.canonical_records}",
            "config":"${workflow.input.nameparse_config}"
          },
          "headers": {
            "Content-Type": "application/json"
          }
        }
      }
    },
     {
      "name": "email_hygiene_task",
      "taskReferenceName": "email_hygiene",
      "type": "HTTP",
      "startDelay": 0,
      "retryCount": 3,
      "retryDelaySeconds": 2,
      "timeoutSeconds": 30,
      "inputParameters": {
        "http_request": {
          "uri": "http://email-hygiene-realtime:9000/process",
          "method": "POST",
          "connectionTimeOut": 3000, 
          "readTimeOut": 10000, 
          "body": {
            "header": {
              "tags": ["API","nua","da","dps","wb","analysis","compilation","da-dps-reader-lambda","tech-showcase"],
              "jobId": "${workflow.input.jobId}"
            },
            "request": "${nameparse.output.response.body.canonical_records}"
          },
          "headers": {
            "Content-Type": "application/json"
          }
        }
      }
    },
    {
  "name": "export_to_csv_task",
  "taskReferenceName": "export_to_csv",
  "type": "HTTP",
  "startDelay": 0,
  "retryCount": 3,
  "retryDelaySeconds": 2,
  "timeoutSeconds": 60,
  "inputParameters": {
    "http_request": {
      "uri": "http://export-to-csv-realtime:9000/process",
      "method": "POST",
      "connectionTimeOut": 3000,
      "readTimeOut": 20000,
      "body": {
        "canonical_records": "${email_hygiene.output.response.body.canonical_records}",
        "jobId": "${workflow.input.jobId}",
        "output_field_selection": "${workflow.input.output_field_selection}"
      },
      "headers": {
        "Content-Type": "application/json"
      }
    }
  }
}
  ],
  "outputParameters": {
    "final_canonical_records": "${email_hygiene.output.response.body.canonical_records}"
  },
  "schemaVersion": 2
}
]
